You are an expert software engineer. Execute the following requirement immediately. Do not ask questions, do not wait for confirmation. Read the requirement carefully and implement all changes to the codebase as specified.

REQUIREMENT TO EXECUTE NOW:

You are an expert software engineer. Execute the following requirement immediately. Do not ask questions, do not wait for confirmation. Read the requirement carefully and implement all changes to the codebase as specified.

REQUIREMENT TO EXECUTE NOW:

# Keyboard-Friendly Context Menu with Focus Trap

## Metadata
- **Category**: ui
- **Effort**: Medium (2/3)
- **Impact**: Medium (2/3)
- **Scan Type**: ui_perfectionist
- **Generated**: 11/23/2025, 11:39:09 AM

## Description
Wrap the ContextMenu portal in a focus-trap that cycles through menu items using arrow keys. Add ARIA roles (menu, menuitem) and aria-controls to link menu to target card. Ensure Escape closes the menu and tab order remains logical across the page.

## Reasoning
Providing full keyboard support makes the admin dashboard accessible to users with motor impairments and satisfies WCAG AA requirements. A focus-trap prevents accidental navigation out of the menu, improving usability. This enhancement increases overall user satisfaction without major performance impact.

## Context

**Note**: This section provides supporting architectural documentation and is NOT a hard requirement. Use it as guidance to understand existing code structure and maintain consistency.

### Context: Admin - Database Maintenance Dashboard

**Description**: ## Overview
The Admin Dashboard provides database maintenance tools for managing the G.O.A.T. application's item collection. The primary focus is identifying and fixing items that are missing images through AI-powered search, manual entry, or web search integration. The dashboard uses React Query for data fetching, Framer Motion for animations, and integrates with the Gemini AI provider for intelligent image discovery.

## Key Capabilities
- **Missing Image Detection**: Automatically identifies and displays items without image URLs in a masonry grid layout
- **AI-Powered Image Search**: Uses Gemini AI with Wikimedia search to automatically find and assign appropriate images to items
- **Manual Image Management**: Provides inline editing interface for admins to manually enter image URLs or search Google Images
- **Context Menu Actions**: Right-click context menu with multiple image acquisition options (AI search, manual entry, Google Images)
- **Real-time Updates**: Automatically refreshes the grid after image assignments using React Query invalidation

## Architecture

### Component Breakdown
| Component/File | Purpose | Layer |
|----------------|---------|-------|
| `src/app/admin/page.tsx` | Admin page route entry point | Route |
| `src/app/features/Admin/AdminDashboard.tsx` | Main dashboard layout with header and sections | UI |
| `src/app/features/Admin/MissingImagesSection.tsx` | Section displaying items without images in masonry grid | UI |
| `src/app/features/Admin/AdminItemCard.tsx` | Enhanced item card with edit mode, context menu, and AI search | UI |
| `src/app/features/Admin/ContextMenu.tsx` | Reusable right-click context menu component with portal rendering | UI |
| `src/app/features/Admin/index.ts` | Feature exports barrel file | Export |
| `src/app/api/admin/search-image/route.ts` | API endpoint for AI-powered image search via Gemini | API |

### Data Flow
1. **Initial Load**: MissingImagesSection queries `/api/top/items?missing_image=true` via React Query
2. **Display**: Items render in masonry grid using MasonryGrid component
3. **AI Search**: Right-click → Search Wikimedia → POST to `/api/admin/search-image` → Gemini searches web → Returns image URL → Auto-saves via PUT to `/api/top/items/:id`
4. **Manual Edit**: Click edit button → Enter URL → Save → PUT to `/api/top/items/:id` → Refetch query
5. **Grid Update**: After any save, React Query refetches the missing images list to reflect changes

### Key Dependencies
- **External**: @tanstack/react-query (data fetching), framer-motion (animations), lucide-react (icons), react-dom (portal for context menu)
- **Internal**: `@/lib/api/client` (API client), `@/components/ui/masonry-grid` (grid layout), `@/components/ui/item-card` (base card), `@/lib/providers/gemini` (AI provider)

## Technical Details

### State Management
- **React Query**: Manages server state for missing images list with `queryKey: ['admin', 'missing-images']`
- **Local Component State**: AdminItemCard uses useState for edit mode, image URL input, saving status, and context menu position
- **Optimistic Updates**: After image save, triggers `refetch()` to immediately update the grid

### API Endpoints
- **GET /api/top/items**: Fetch items with `missing_image=true` filter (limit 20, sorted by created_at desc)
- **PUT /api/top/items/:id**: Update item's image_url field
- **POST /api/admin/search-image**: AI-powered image search using Gemini with web search (max 30s duration)

### Database Tables
- **items**: Main table queried for items with `image_url IS NULL` or empty string
  - Fields: id, name, image_url, description, category, subcategory, group, item_year, created_at

### UI Patterns
- **Masonry Grid**: Responsive grid with columns: sm=2, md=3, lg=4, xl=5
- **Context Menu**: Portal-rendered menu with viewport-aware positioning (adjusts to stay within bounds)
- **Edit Overlay**: AnimatePresence with motion overlay for inline URL editing
- **Loading States**: Skeleton loaders during initial fetch, spinner during AI search
- **Keyboard Shortcuts**: Enter to save, Escape to cancel in edit mode
**Related Files**:
- `src/app/admin/page.tsx`
- `src/app/features/Admin/AdminDashboard.tsx`
- `src/app/features/Admin/MissingImagesSection.tsx`
- `src/app/features/Admin/AdminItemCard.tsx`
- `src/app/features/Admin/ContextMenu.tsx`
- `src/app/features/Admin/index.ts`
- `src/app/api/admin/search-image/route.ts`

**Post-Implementation**: After completing this requirement, evaluate if the context description or file paths need updates. Use the appropriate API/DB query to update the context if architectural changes were made.

## Recommended Skills

- **compact-ui-design**: Use `.claude/skills/compact-ui-design.md` for high-quality UI design references and patterns

## Notes

This requirement was generated from an AI-evaluated project idea. No specific goal is associated with this idea.

## Implementation Guidelines

**IMPORTANT**: Execute the requirement immediately without asking for confirmation or approval.

**Steps**:
1. Analyze the requirement thoroughly
2. Identify all files that need to be modified or created
3. Implement all changes specified in the requirement
4. Follow implementation steps precisely
5. Run any tests if specified
6. Ensure all changes are complete before finishing

## File Structure (Next.js/React Projects)

**Feature-Specific Files** (use `app/features/<feature>` structure):
- `app/features/<feature>/components/` - Feature-specific components and UI
- `app/features/<feature>/lib/` - Feature-specific functions, utilities, helpers
- `app/features/<feature>/` - Main wrapper, index, or page file

**Reusable UI Components** (use `app/components/ui` structure):
- `app/components/ui/` - Shared, reusable UI elements across multiple features

## Test Selectors

**CRITICAL**: Add `data-testid` attributes to ALL interactive UI components for automated testing.

**Guidelines**:
- Add to all clickable elements (buttons, links, icons)
- Use descriptive kebab-case: `data-testid="submit-form-btn"`
- Include component context: `data-testid="goal-delete-btn"`, `data-testid="project-settings-modal"`
- Add to form inputs: `data-testid="email-input"`
- Add to list items: `data-testid="task-item-123"`

**Example**:
```tsx
<button onClick={handleSubmit} data-testid="create-goal-btn">
  Create Goal
</button>

<input
  type="text"
  value={title}
  onChange={handleChange}
  data-testid="goal-title-input"
/>
```

## Theming and Styling

**Before creating new UI components**:
1. Examine existing components in the project
2. Match the color scheme, spacing, and visual patterns
3. Use consistent className patterns (Tailwind CSS)
4. Follow the app's design language (glassmorphism, gradients, shadows, etc.)
5. Support dark mode if the app uses it

## Documentation Policy

**CRITICAL RULE**: Do NOT create separate documentation files (.md, README.md, docs/) for routine implementations.

**Only create documentation when**:
- Implementing a NEW major feature or module (not refactorings)
- Adding a NEW API or public interface
- Creating NEW architectural patterns
- The requirement explicitly asks for documentation

**Do NOT create documentation for**:
- Bug fixes
- Refactorings
- Small adjustments
- UI changes
- Database schema changes
- Performance improvements
- Code quality improvements

**For all implementations**: Create an implementation log entry (see next section) - this is your primary documentation.

## Implementation Logging

**CRITICAL**: After completing the implementation, create ONE log entry using the implementation-log repository.

**DO NOT**:
- ❌ Create standalone SQL scripts
- ❌ Create separate logging files
- ❌ Insert SQL directly into project databases
- ❌ Use `sqlite3` commands

**DO**:
- ✅ Use the repository function directly in a simple Node.js script
- ✅ Run the script once to create the log entry
- ✅ Delete the script after execution

**Step 1**: Create a simple logging script

```typescript
// create-log.ts (or create-log.mjs with import syntax)
import { implementationLogDb } from '@/app/db';
import { randomUUID } from 'crypto';

implementationLogDb.createLog({
  id: randomUUID(),
  project_id: '4ee93a8c-9318-4497-b7cf-05027e48f12b',
  context_id: 'ctx_1763865209179_nvmq9o10i',
  requirement_name: '<requirement-file-name-without-.md>',
  title: '<2-6 words describing what was done>',
  overview: '<1-2 paragraphs: What was implemented, key files modified/created, major functionality added>',
  overview_bullets: '<bullet1>\n<bullet2>\n<bullet3>',
  tested: false,
  screenshot: null, // Will be populated if screenshot succeeds
});

console.log('✅ Implementation log created');
```

**Step 2**: Run the script

```bash
npx tsx create-log.ts
# or
node create-log.mjs
```

**Step 3**: Delete the script

```bash
rm create-log.ts
# or del create-log.ts on Windows
```

**Field Guidelines**:
- `id`: Use `randomUUID()` or `crypto.randomUUID()`
- `requirement_name`: Requirement filename WITHOUT .md extension
- `title`: 2-6 words (e.g., "User Authentication System")
- `overview`: 1-2 paragraphs describing what was done
- `overview_bullets`: 3-5 bullets separated by \n (e.g., "Added OAuth flow\nCreated auth context\nUpdated login UI")
- `tested`: Always `false` initially

**Example**:
```typescript
implementationLogDb.createLog({
  id: randomUUID(),
  project_id: 'proj-123',
  requirement_name: 'implement-dark-mode',
  title: 'Dark Mode Implementation',
  overview: 'Implemented global dark mode toggle with theme persistence. Added theme context provider, updated all UI components to support dark mode, and created settings panel for theme switching.',
  overview_bullets: 'Created ThemeProvider context\nUpdated 25+ components with dark mode styles\nAdded theme toggle in settings\nImplemented localStorage persistence',
  tested: false
});
```

## Screenshot Capture (Context-Related Only)

**Workflow**:

### Step 1: Check if Test Scenario Exists

```bash
curl -X POST "http://localhost:3000/api/tester/screenshot" \
  -H "Content-Type: application/json" \
  -d '{"contextId":"ctx_1763865209179_nvmq9o10i","scanOnly":true}'
```

**If `hasScenario: false`**: Skip all remaining screenshot steps. Set `screenshot: null` in log.

### Step 2: Start Dev Server (ONLY if scenario exists)

Start your development server manually (e.g., `npm run dev`)

### Step 3: Capture Screenshot

```bash
curl -X POST "http://localhost:3000/api/tester/screenshot" \
  -H "Content-Type: application/json" \
  -d '{"contextId":"ctx_1763865209179_nvmq9o10i"}'
```

### Step 4: Stop Server (CRITICAL)

Stop your development server

### Step 5: Update Log with Screenshot Path

Use the `screenshotPath` from API response in your log creation:

```typescript
screenshot: screenshotPath || null
```

**Error Handling**:
- No scenario → `screenshot: null`
- Server fails (unrelated to your code) → `screenshot: null`
- Server fails (your bugs) → Fix bugs, retry, then screenshot
- Screenshot API fails → `screenshot: null`
- **Always stop the server** to free the port for next task

## Final Checklist

Before finishing:
- [ ] All code changes implemented
- [ ] Test IDs added to interactive components
- [ ] File structure follows guidelines
- [ ] UI components match existing theme
- [ ] Implementation log entry created
- [ ] Screenshot captured (if test scenario exists)
- [ ] NO separate documentation files created (unless new major feature)

Begin implementation now.

## Implementation Guidelines

**IMPORTANT**: Execute the requirement immediately without asking for confirmation or approval.

**Steps**:
1. Analyze the requirement thoroughly
2. Identify all files that need to be modified or created
3. Implement all changes specified in the requirement
4. Follow implementation steps precisely
5. Run any tests if specified
6. Ensure all changes are complete before finishing

## File Structure (Next.js/React Projects)

**Feature-Specific Files** (use `app/features/<feature>` structure):
- `app/features/<feature>/components/` - Feature-specific components and UI
- `app/features/<feature>/lib/` - Feature-specific functions, utilities, helpers
- `app/features/<feature>/` - Main wrapper, index, or page file

**Reusable UI Components** (use `app/components/ui` structure):
- `app/components/ui/` - Shared, reusable UI elements across multiple features

## Test Selectors

**CRITICAL**: Add `data-testid` attributes to ALL interactive UI components for automated testing.

**Guidelines**:
- Add to all clickable elements (buttons, links, icons)
- Use descriptive kebab-case: `data-testid="submit-form-btn"`
- Include component context: `data-testid="goal-delete-btn"`, `data-testid="project-settings-modal"`
- Add to form inputs: `data-testid="email-input"`
- Add to list items: `data-testid="task-item-123"`

**Example**:
```tsx
<button onClick={handleSubmit} data-testid="create-goal-btn">
  Create Goal
</button>

<input
  type="text"
  value={title}
  onChange={handleChange}
  data-testid="goal-title-input"
/>
```

## Theming and Styling

**Before creating new UI components**:
1. Examine existing components in the project
2. Match the color scheme, spacing, and visual patterns
3. Use consistent className patterns (Tailwind CSS)
4. Follow the app's design language (glassmorphism, gradients, shadows, etc.)
5. Support dark mode if the app uses it

## Documentation Policy

**CRITICAL RULE**: Do NOT create separate documentation files (.md, README.md, docs/) for routine implementations.

**Only create documentation when**:
- Implementing a NEW major feature or module (not refactorings)
- Adding a NEW API or public interface
- Creating NEW architectural patterns
- The requirement explicitly asks for documentation

**Do NOT create documentation for**:
- Bug fixes
- Refactorings
- Small adjustments
- UI changes
- Database schema changes
- Performance improvements
- Code quality improvements

**For all implementations**: Create an implementation log entry (see next section) - this is your primary documentation.

## Implementation Logging

**CRITICAL**: After completing the implementation, create ONE log entry using the implementation-log repository.

**DO NOT**:
- ❌ Create standalone SQL scripts
- ❌ Create separate logging files
- ❌ Insert SQL directly into project databases
- ❌ Use `sqlite3` commands

**DO**:
- ✅ Use the repository function directly in a simple Node.js script
- ✅ Run the script once to create the log entry
- ✅ Delete the script after execution

**Step 1**: Create a simple logging script

```typescript
// create-log.ts (or create-log.mjs with import syntax)
import { implementationLogDb } from '@/app/db';
import { randomUUID } from 'crypto';

implementationLogDb.createLog({
  id: randomUUID(),
  project_id: '4ee93a8c-9318-4497-b7cf-05027e48f12b',
  requirement_name: '<requirement-file-name-without-.md>',
  title: '<2-6 words describing what was done>',
  overview: '<1-2 paragraphs: What was implemented, key files modified/created, major functionality added>',
  overview_bullets: '<bullet1>\n<bullet2>\n<bullet3>',
  tested: false,
});

console.log('✅ Implementation log created');
```

**Step 2**: Run the script

```bash
npx tsx create-log.ts
# or
node create-log.mjs
```

**Step 3**: Delete the script

```bash
rm create-log.ts
# or del create-log.ts on Windows
```

**Field Guidelines**:
- `id`: Use `randomUUID()` or `crypto.randomUUID()`
- `requirement_name`: Requirement filename WITHOUT .md extension
- `title`: 2-6 words (e.g., "User Authentication System")
- `overview`: 1-2 paragraphs describing what was done
- `overview_bullets`: 3-5 bullets separated by \n (e.g., "Added OAuth flow\nCreated auth context\nUpdated login UI")
- `tested`: Always `false` initially

**Example**:
```typescript
implementationLogDb.createLog({
  id: randomUUID(),
  project_id: 'proj-123',
  requirement_name: 'implement-dark-mode',
  title: 'Dark Mode Implementation',
  overview: 'Implemented global dark mode toggle with theme persistence. Added theme context provider, updated all UI components to support dark mode, and created settings panel for theme switching.',
  overview_bullets: 'Created ThemeProvider context\nUpdated 25+ components with dark mode styles\nAdded theme toggle in settings\nImplemented localStorage persistence',
  tested: false
});
```

## Final Checklist

Before finishing:
- [ ] All code changes implemented
- [ ] Test IDs added to interactive components
- [ ] File structure follows guidelines
- [ ] UI components match existing theme
- [ ] Implementation log entry created
- [ ] NO separate documentation files created (unless new major feature)

Begin implementation now.