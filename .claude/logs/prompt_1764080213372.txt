You are an expert software engineer. Execute the following requirement immediately. Do not ask questions, do not wait for confirmation. Read the requirement carefully and implement all changes to the codebase as specified.

REQUIREMENT TO EXECUTE NOW:

# Refactoring Batch 5 of 6

> **üìã REFACTORING REQUIREMENT FILE**
> Project: GOAT
> Issues in this batch: 20
> Generated by Vibeman RefactorWizard

---

## Overview

This batch contains **20 refactoring opportunities** to address.
Please work through each issue systematically, ensuring tests pass after each change.

### Summary

**By Category:**
- maintainability: 9
- code-quality: 4
- duplication: 7

**By Severity:**
- medium: 14
- high: 6

---

## Issues to Address

### 1. Magic numbers in src/app/api/top/groups/categories/[category]/route.ts

**Category**: maintainability | **Severity**: medium | **Effort**: low

**Description**:
Found 3 magic numbers that should be extracted to named constants. Suggested names: HTTP_STATUS_500, HTTP_STATUS_500, HTTP_STATUS_500

**Impact**:
Improves code maintainability and clarity

**Files Affected**:
- `src/app/api/top/groups/categories/[category]/route.ts`

**Line Numbers**:
- src/app/api/top/groups/categories/[category]/route.ts: lines 57, 76, 109

‚úÖ **Auto-fix available**

---

### 2. Missing React Hook dependencies  (21 files)

**Category**: code-quality | **Severity**: high | **Effort**: low

**Description**:
This issue affects 21 files across the codebase. Found 6 hooks with missing dependencies. This can cause stale closures and bugs.

**Impact**:
Prevents bugs caused by stale closures

**Files Affected**:
- `src/providers/BacklogProvider.tsx`
- `src/components/app/ProgressMain.tsx`
- `src/components/app/landing/ListSelectionModal.tsx`
- `src/app/features/Collection/SimpleCollectionPanel.tsx`
- `src/app/features/Awards/AwardList.tsx`
- `src/app/features/Admin/ContextMenu.tsx`
- `src/app/features/matching/components/SwipeableCard.tsx`
- `src/app/features/Match/sub_MatchGrid/SimpleMatchGrid.tsx`
- `src/app/features/Match/sub_MatchCollections/SimpleDropZone.tsx`
- `src/app/features/Match/sub_MatchCollections/SimpleCollectionPanel.tsx`

‚úÖ **Auto-fix available**

---

### 3. Code duplication in src/components/page-transition.tsx

**Category**: duplication | **Severity**: medium | **Effort**: medium

**Description**:
Found 2 duplicated code blocks that could be extracted into reusable functions.

**Impact**:
Reduces code duplication and improves maintainability

**Files Affected**:
- `src/components/page-transition.tsx`

‚úÖ **Auto-fix available**

---

### 4. Code duplication in src/components/ui/stats-card.tsx

**Category**: duplication | **Severity**: medium | **Effort**: medium

**Description**:
Found 28 duplicated code blocks that could be extracted into reusable functions.

**Impact**:
Reduces code duplication and improves maintainability

**Files Affected**:
- `src/components/ui/stats-card.tsx`

‚úÖ **Auto-fix available**

---

### 5. Magic numbers in src/components/ui/stats-card.tsx

**Category**: maintainability | **Severity**: medium | **Effort**: medium

**Description**:
Found 71 magic numbers that should be extracted to named constants.

**Impact**:
Improves code maintainability and clarity

**Files Affected**:
- `src/components/ui/stats-card.tsx`

**Line Numbers**:
- src/components/ui/stats-card.tsx: lines 17, 18, 18, 18, 18, 18, 19, 45, 45, 45, 45, 45, 45, 51, 116, 116, 116, 116, 136, 145, 145, 145, 145, 145, 148, 148, 149, 149, 158, 158, 160, 160, 160, 160, 161, 161, 162, 170, 173, 173, 174, 174, 198, 199, 200, 201, 202, 203, 204, 207, 211, 213, 214, 221, 229, 237, 270, 318, 323, 346, 346, 347, 347, 348, 348, 348, 349, 349, 349, 374, 374

‚úÖ **Auto-fix available**

---

### 6. Magic numbers in src/components/ui/star-rating.tsx

**Category**: maintainability | **Severity**: high | **Effort**: medium

**Description**:
Found 52 magic numbers that should be extracted to named constants.

**Impact**:
Improves code maintainability and clarity

**Files Affected**:
- `src/components/ui/star-rating.tsx`

**Line Numbers**:
- src/components/ui/star-rating.tsx: lines 39, 50, 50, 51, 51, 52, 52, 95, 103, 107, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 121, 125, 126, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 137

‚úÖ **Auto-fix available**

---

### 7. Code duplication in src/components/ui/progressive-image.tsx

**Category**: duplication | **Severity**: medium | **Effort**: medium

**Description**:
Found 2 duplicated code blocks that could be extracted into reusable functions.

**Impact**:
Reduces code duplication and improves maintainability

**Files Affected**:
- `src/components/ui/progressive-image.tsx`

‚úÖ **Auto-fix available**

---

### 8. Magic numbers in src/components/ui/progressive-image.tsx

**Category**: maintainability | **Severity**: medium | **Effort**: low

**Description**:
Found 6 magic numbers that should be extracted to named constants.

**Impact**:
Improves code maintainability and clarity

**Files Affected**:
- `src/components/ui/progressive-image.tsx`

**Line Numbers**:
- src/components/ui/progressive-image.tsx: lines 53, 82, 99, 131, 135, 141

‚úÖ **Auto-fix available**

---

### 9. Magic numbers in src/components/ui/masonry-grid.tsx

**Category**: maintainability | **Severity**: high | **Effort**: medium

**Description**:
Found 12 magic numbers that should be extracted to named constants.

**Impact**:
Improves code maintainability and clarity

**Files Affected**:
- `src/components/ui/masonry-grid.tsx`

**Line Numbers**:
- src/components/ui/masonry-grid.tsx: lines 54, 72, 72, 72, 88, 102, 137, 137, 137, 139, 141, 143

‚úÖ **Auto-fix available**

---

### 10. Missing React Hook dependencies in src/components/ui/masonry-grid.tsx

**Category**: code-quality | **Severity**: high | **Effort**: low

**Description**:
Found 1 hooks with missing dependencies. This can cause stale closures and bugs.

**Impact**:
Prevents bugs caused by stale closures

**Files Affected**:
- `src/components/ui/masonry-grid.tsx`

**Line Numbers**:
- src/components/ui/masonry-grid.tsx: lines 129

‚úÖ **Auto-fix available**

---

### 11. Code duplication in src/components/ui/list-grid.tsx

**Category**: duplication | **Severity**: medium | **Effort**: medium

**Description**:
Found 14 duplicated code blocks that could be extracted into reusable functions.

**Impact**:
Reduces code duplication and improves maintainability

**Files Affected**:
- `src/components/ui/list-grid.tsx`

‚úÖ **Auto-fix available**

---

### 12. Magic numbers in src/components/ui/list-grid.tsx

**Category**: maintainability | **Severity**: medium | **Effort**: medium

**Description**:
Found 52 magic numbers that should be extracted to named constants.

**Impact**:
Improves code maintainability and clarity

**Files Affected**:
- `src/components/ui/list-grid.tsx`

**Line Numbers**:
- src/components/ui/list-grid.tsx: lines 81, 84, 93, 98, 126, 126, 127, 127, 127, 127, 142, 142, 142, 142, 142, 149, 149, 155, 155, 155, 155, 155, 173, 173, 173, 173, 173, 180, 216, 216, 235, 235, 236, 236, 236, 236, 255, 255, 255, 255, 256, 257, 257, 275, 275, 276, 276, 280, 280, 280, 280, 280

‚úÖ **Auto-fix available**

---

### 13. Large file detected: src/components/ui/item-card.tsx

**Category**: maintainability | **Severity**: medium | **Effort**: high

**Description**:
This file has 404 lines. Consider splitting it into smaller, more focused modules. Target: Keep files under 200 lines for better maintainability.

**Impact**:
Improves code organization, readability, and maintainability

**Files Affected**:
- `src/components/ui/item-card.tsx`

---

### 14. Code duplication in src/components/ui/item-card.tsx

**Category**: duplication | **Severity**: medium | **Effort**: medium

**Description**:
Found 35 duplicated code blocks that could be extracted into reusable functions.

**Impact**:
Reduces code duplication and improves maintainability

**Files Affected**:
- `src/components/ui/item-card.tsx`

‚úÖ **Auto-fix available**

---

### 15. Magic numbers in src/components/ui/item-card.tsx

**Category**: maintainability | **Severity**: medium | **Effort**: medium

**Description**:
Found 49 magic numbers that should be extracted to named constants.

**Impact**:
Improves code maintainability and clarity

**Files Affected**:
- `src/components/ui/item-card.tsx`

**Line Numbers**:
- src/components/ui/item-card.tsx: lines 19, 19, 19, 19, 19, 20, 20, 21, 21, 21, 25, 35, 35, 35, 137, 137, 137, 137, 138, 138, 140, 140, 140, 141, 149, 149, 233, 245, 252, 265, 265, 279, 279, 279, 293, 293, 293, 303, 303, 303, 304, 314, 354, 355, 361, 361, 369, 392, 392

‚úÖ **Auto-fix available**

---

### 16. Code duplication in src/components/ui/context-menu.tsx

**Category**: duplication | **Severity**: medium | **Effort**: medium

**Description**:
Found 48 duplicated code blocks that could be extracted into reusable functions.

**Impact**:
Reduces code duplication and improves maintainability

**Files Affected**:
- `src/components/ui/context-menu.tsx`

‚úÖ **Auto-fix available**

---

### 17. Missing React Hook dependencies in src/components/theme/theme-provider.tsx

**Category**: code-quality | **Severity**: high | **Effort**: low

**Description**:
Found 1 hooks with missing dependencies. This can cause stale closures and bugs.

**Impact**:
Prevents bugs caused by stale closures

**Files Affected**:
- `src/components/theme/theme-provider.tsx`

**Line Numbers**:
- src/components/theme/theme-provider.tsx: lines 21

‚úÖ **Auto-fix available**

---

### 18. Code duplication in src/app/match-test/page.tsx

**Category**: duplication | **Severity**: medium | **Effort**: medium

**Description**:
Found 6 duplicated code blocks that could be extracted into reusable functions.

**Impact**:
Reduces code duplication and improves maintainability

**Files Affected**:
- `src/app/match-test/page.tsx`

‚úÖ **Auto-fix available**

---

### 19. Magic numbers in src/app/match-test/page.tsx

**Category**: maintainability | **Severity**: medium | **Effort**: medium

**Description**:
Found 33 magic numbers that should be extracted to named constants.

**Impact**:
Improves code maintainability and clarity

**Files Affected**:
- `src/app/match-test/page.tsx`

**Line Numbers**:
- src/app/match-test/page.tsx: lines 40, 135, 135, 135, 137, 137, 137, 137, 138, 147, 147, 147, 149, 149, 152, 152, 152, 164, 164, 164, 166, 166, 169, 169, 169, 199, 199, 199, 201, 201, 201, 201, 202

‚úÖ **Auto-fix available**

---

### 20. Missing React Hook dependencies in src/app/match-test/page.tsx

**Category**: code-quality | **Severity**: high | **Effort**: low

**Description**:
Found 1 hooks with missing dependencies. This can cause stale closures and bugs.

**Impact**:
Prevents bugs caused by stale closures

**Files Affected**:
- `src/app/match-test/page.tsx`

**Line Numbers**:
- src/app/match-test/page.tsx: lines 45

‚úÖ **Auto-fix available**

---

## Validation Checklist

- [ ] All 20 issues addressed
- [ ] Tests passing (`npm test`)
- [ ] Type checking passing (`npx tsc --noEmit`)
- [ ] No new linting errors
- [ ] Changes committed with descriptive messages

---

**Batch**: 5 of 6
**Total Issues**: 20


## Implementation Guidelines

**IMPORTANT**: Execute the requirement immediately without asking for confirmation or approval.

**Steps**:
1. Analyze the requirement thoroughly
2. Identify all files that need to be modified or created
3. Implement all changes specified in the requirement
4. Follow implementation steps precisely
5. Run any tests if specified
6. Ensure all changes are complete before finishing

## File Structure (Next.js/React Projects)

**Feature-Specific Files** (use `app/features/<feature>` structure):
- `app/features/<feature>/components/` - Feature-specific components and UI
- `app/features/<feature>/lib/` - Feature-specific functions, utilities, helpers
- `app/features/<feature>/` - Main wrapper, index, or page file

**Reusable UI Components** (use `app/components/ui` structure):
- `app/components/ui/` - Shared, reusable UI elements across multiple features

## Test Selectors

**CRITICAL**: Add `data-testid` attributes to ALL interactive UI components for automated testing.

**Guidelines**:
- Add to all clickable elements (buttons, links, icons)
- Use descriptive kebab-case: `data-testid="submit-form-btn"`
- Include component context: `data-testid="goal-delete-btn"`, `data-testid="project-settings-modal"`
- Add to form inputs: `data-testid="email-input"`
- Add to list items: `data-testid="task-item-123"`

**Example**:
```tsx
<button onClick={handleSubmit} data-testid="create-goal-btn">
  Create Goal
</button>

<input
  type="text"
  value={title}
  onChange={handleChange}
  data-testid="goal-title-input"
/>
```

## Theming and Styling

**Before creating new UI components**:
1. Examine existing components in the project
2. Match the color scheme, spacing, and visual patterns
3. Use consistent className patterns (Tailwind CSS)
4. Follow the app's design language (glassmorphism, gradients, shadows, etc.)
5. Support dark mode if the app uses it

## Documentation Policy

**CRITICAL RULE**: Do NOT create separate documentation files (.md, README.md, docs/) for routine implementations.

**Only create documentation when**:
- Implementing a NEW major feature or module (not refactorings)
- Adding a NEW API or public interface
- Creating NEW architectural patterns
- The requirement explicitly asks for documentation

**Do NOT create documentation for**:
- Bug fixes
- Refactorings
- Small adjustments
- UI changes
- Database schema changes
- Performance improvements
- Code quality improvements

**For all implementations**: Create an implementation log entry (see next section) - this is your primary documentation.

## Implementation Logging

**CRITICAL**: After completing the implementation, create ONE log entry using the implementation-log repository.

**DO NOT**:
- ‚ùå Create standalone SQL scripts
- ‚ùå Create separate logging files
- ‚ùå Insert SQL directly into project databases
- ‚ùå Use `sqlite3` commands

**DO**:
- ‚úÖ Use the repository function directly in a simple Node.js script
- ‚úÖ Run the script once to create the log entry
- ‚úÖ Delete the script after execution

**Step 1**: Create a simple logging script

```typescript
// create-log.ts (or create-log.mjs with import syntax)
import { implementationLogDb } from '@/app/db';
import { randomUUID } from 'crypto';

implementationLogDb.createLog({
  id: randomUUID(),
  project_id: '4ee93a8c-9318-4497-b7cf-05027e48f12b',
  requirement_name: '<requirement-file-name-without-.md>',
  title: '<2-6 words describing what was done>',
  overview: '<1-2 paragraphs: What was implemented, key files modified/created, major functionality added>',
  overview_bullets: '<bullet1>\n<bullet2>\n<bullet3>',
  tested: false,
});

console.log('‚úÖ Implementation log created');
```

**Step 2**: Run the script

```bash
npx tsx create-log.ts
# or
node create-log.mjs
```

**Step 3**: Delete the script

```bash
rm create-log.ts
# or del create-log.ts on Windows
```

**Field Guidelines**:
- `id`: Use `randomUUID()` or `crypto.randomUUID()`
- `requirement_name`: Requirement filename WITHOUT .md extension
- `title`: 2-6 words (e.g., "User Authentication System")
- `overview`: 1-2 paragraphs describing what was done
- `overview_bullets`: 3-5 bullets separated by \n (e.g., "Added OAuth flow\nCreated auth context\nUpdated login UI")
- `tested`: Always `false` initially

**Example**:
```typescript
implementationLogDb.createLog({
  id: randomUUID(),
  project_id: 'proj-123',
  requirement_name: 'implement-dark-mode',
  title: 'Dark Mode Implementation',
  overview: 'Implemented global dark mode toggle with theme persistence. Added theme context provider, updated all UI components to support dark mode, and created settings panel for theme switching.',
  overview_bullets: 'Created ThemeProvider context\nUpdated 25+ components with dark mode styles\nAdded theme toggle in settings\nImplemented localStorage persistence',
  tested: false
});
```

## Final Checklist

Before finishing:
- [ ] All code changes implemented
- [ ] Test IDs added to interactive components
- [ ] File structure follows guidelines
- [ ] UI components match existing theme
- [ ] Implementation log entry created
- [ ] NO separate documentation files created (unless new major feature)

Begin implementation now.