(()=>{var e={};e.id=582,e.ids=[582],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15261:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>_,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>c,POST:()=>p,dynamic:()=>u});var o=t(30781),i=t(60554),n=t(31625),a=t(96396);!function(){var e=Error("Cannot find module '@/lib/supabase/server'");throw e.code="MODULE_NOT_FOUND",e}();let u="force-dynamic";async function c(e){try{let r=await Object(function(){var e=Error("Cannot find module '@/lib/supabase/server'");throw e.code="MODULE_NOT_FOUND",e}())(),{searchParams:t}=new URL(e.url),s=t.get("category"),o=t.get("subcategory"),i=t.get("search"),n=t.get("sort_by")||"name",u=(t.get("sort_order")||"asc").toLowerCase(),c=parseInt(t.get("limit")||"50"),p=parseInt(t.get("offset")||"0"),l=t.get("group_id"),d="true"===t.get("missing_image");console.log("\uD83D\uDD0D Items API params:",{category:s,subcategory:o,search:i,sortBy:n,sortOrder:u,limit:c,offset:p,groupId:l,missingImage:d});let g=r.from("items").select("*",{count:"exact"});s&&(g=g.eq("category",s)),o&&(g=g.eq("subcategory",o)),l&&(g=g.eq("group_id",l)),i&&(g=g.or(`name.ilike.%${i}%,description.ilike.%${i}%`)),d&&(g=g.is("image_url",null));let m=n;"ranking"===n?m="selection_count":["name","created_at","updated_at","item_year","selection_count","view_count"].includes(n)||(m="name"),g=(g=g.order(m,{ascending:"asc"===u})).range(p,p+c-1),console.log("\uD83D\uDD0D Final sort field:",m,"order:",u);let{data:_,error:y,count:f}=await g;if(y)return console.error("Error fetching items:",y),console.error("Query details - sortField:",m,"sortOrder:",u),a.NextResponse.json({error:y.message,details:y},{status:500});return a.NextResponse.json({items:_||[],total:f||0,limit:c,offset:p,has_more:!!f&&p+c<f})}catch(e){return console.error("Unexpected error in GET /api/top/items:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let r=await Object(function(){var e=Error("Cannot find module '@/lib/supabase/server'");throw e.code="MODULE_NOT_FOUND",e}())(),t=await e.json(),{name:s,category:o}=t;if(!s||!o)return a.NextResponse.json({error:"Missing required fields: name and category are required"},{status:400});let i={name:String(s).trim(),category:String(o).trim()};if(t.subcategory&&(i.subcategory=String(t.subcategory).trim()),t.description&&(i.description=String(t.description).trim()),t.image_url&&(i.image_url=String(t.image_url).trim()),t.reference_url&&(i.reference_url=String(t.reference_url).trim()),void 0!==t.item_year&&null!==t.item_year){let e=parseInt(String(t.item_year));isNaN(e)||(i.item_year=e)}if(void 0!==t.item_year_to&&null!==t.item_year_to){let e=parseInt(String(t.item_year_to));isNaN(e)||(i.item_year_to=e)}t.group&&(i.group=String(t.group).trim()),t.group_id&&(i.group_id=String(t.group_id).trim());let{data:n,error:u}=await r.from("items").insert([i]).select().single();if(u){if(console.error("Error creating item:",u),"23505"===u.code)return a.NextResponse.json({error:"An item with this name, category, and subcategory already exists"},{status:409});return a.NextResponse.json({error:u.message},{status:500})}return a.NextResponse.json(n,{status:201})}catch(e){return console.error("Unexpected error in POST /api/top/items:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/top/items/route",pathname:"/api/top/items",filename:"route",bundlePath:"app/api/top/items/route"},resolvedPagePath:"C:\\Users\\kazda\\kiro\\goat\\src\\app\\api\\top\\items\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:g,serverHooks:m}=l;function _(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:g})}},24429:()=>{},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30781:(e,r,t)=>{"use strict";e.exports=t(44870)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64749:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[706],()=>t(15261));module.exports=s})();